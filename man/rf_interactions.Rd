% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rf_interactions.R
\name{rf_interactions}
\alias{rf_interactions}
\title{Fit random forest models with variable interactions}
\usage{
rf_interactions(
  model = NULL,
  data = NULL,
  dependent.variable.name = NULL,
  predictor.variable.names = NULL,
  xy = NULL,
  ranger.arguments = NULL,
  repetitions = 30,
  ...,
  seed = NULL,
  verbose = TRUE,
  n.cores = NULL
)
}
\arguments{
\item{model}{A model fitted with \code{\link[=rf]{rf()}}. If provided, arguments are extracted from the model. Default: \code{NULL}}

\item{data}{Data frame with a response variable and a set of predictors. Default: \code{NULL}}

\item{dependent.variable.name}{Character string with the name of the response variable. Must be in the column names of \code{data}. If the dependent variable is binary with values 1 and 0, the argument \code{case.weights} of \code{ranger} is populated by the function \code{\link[collinear:case_weights]{collinear::case_weights()}}. Default: \code{NULL}}

\item{predictor.variable.names}{Character vector with the names of the predictive variables. Default: \code{NULL}}

\item{xy}{Data frame or matrix with two columns containing coordinates and named "x" and "y". Required for spatial cross-validation.}

\item{ranger.arguments}{Named list with \link[ranger]{ranger} arguments (other arguments of this function can also go here). All \link[ranger]{ranger} arguments are set to their default values except for 'importance', that is set to 'permutation' rather than 'none'. Please, consult the help file of \link[ranger]{ranger} if you are not familiar with the arguments of this function.}

\item{repetitions}{Integer, number of spatial folds to use during cross-validation. Must be lower than the total number of rows available in the model's data. Default: \code{30}}

\item{...}{Advanced arguments:
\itemize{
\item \code{training.fraction}: Proportion between 0.5 and 0.9 for training set during cross-validation (default: 0.75)
\item \code{importance.threshold}: Quantile (0-1) of variable importance for selecting predictors to test interactions (default: 0.75)
\item \code{cor.threshold}: Maximum Pearson correlation between interactions and predictors (default: 0.75)
\item \code{point.color}: Colors for plotted points (default: \code{grDevices::hcl.colors(100, palette = "Zissou 1", alpha = 0.8)})
}}

\item{seed}{Integer, random seed to facilitate reproducibility. If set to a given number, the results of the function are always the same. Default: \code{NULL}}

\item{verbose}{Logical. If \code{TRUE}, messages and plots generated during the execution of the function are displayed. Default: \code{TRUE}}

\item{n.cores}{Integer. Number of threads for ranger's internal parallelization. Default: \code{NULL} (auto-detected: when a parallel plan is active via \code{future::plan()}, n.cores is set to 1; otherwise defaults to \code{future::availableCores(omit = 1)}). When a parallel plan is active, n.cores is always set to 1 to prevent oversubscription, regardless of user input.}
}
\value{
A ranger model (class \code{c("rf", "rf_interactions", "ranger")}) with all standard slots from \code{\link[=rf]{rf()}} plus an \code{interactions} slot containing:
\itemize{
\item \code{method}: Character vector of interaction types (c("multiplicative", "pca"))
\item \code{screening}: Data frame with all tested interactions and scores
\item \code{selected}: Data frame with selected interactions only
\item \code{values}: Data frame with computed interaction values
\item \code{names}: Character vector of selected interaction names
\item \code{plots}: Named list of ggplot objects (interaction vs response)
\item \code{comparison}: List comparing models with/without interactions
\item \code{parameters}: List of selection parameters used
}
}
\description{
Identifies and incorporates variable interactions into random forest models. Tests multiplicative (\code{a * b}) and PCA-based composite features, selects promising interactions via spatial cross-validation, and returns a fitted model with selected interactions included as predictors.

Candidate variables \code{a} and \code{b} are selected from predictors with variable importance above \code{importance.threshold} (default: 75th percentile). For each interaction, a model including all predictors plus the interaction is fitted and evaluated via spatial cross-validation. Only interactions with positive metric gain (RÂ² or AUC), importance above the median, and correlation below \code{cor.threshold} are selected.
}
\details{
For a pair of predictors \code{a} and \code{b}, multiplicative interactions are built via \code{a * b}, while PCA-based composite features are built by extracting the first factor from a PCA performed with \code{\link[=pca]{pca()}} after rescaling \code{a} and \code{b} between 1 and 100. Interactions are named \code{a..x..b} and \code{a..pca..b} respectively.
}
\examples{

if (interactive()) {
  data(plants_df, plants_xy, plants_rf)

  # Approach 1: From existing model
  m_int <- rf_interactions(
    model = plants_rf,
    xy = plants_xy,
    repetitions = 5,
    n.cores = 1
  )

  # Approach 2: From scratch with advanced args
  predictors <- c("bio1", "bio12", "pH", "aridityIndexThornthwaite")
  m_int <- rf_interactions(
    data = plants_df[1:30, ],
    dependent.variable.name = "richness_species_vascular",
    predictor.variable.names = predictors,
    xy = plants_xy[1:30, ],
    repetitions = 5,
    training.fraction = 0.75,
    importance.threshold = 0.75,
    n.cores = 1
  )

  # Access results
  m_int$interactions$selected
  m_int$interactions$plots
  m_int$interactions$comparison$comparison.plot

  # Use like any rf model
  plot_importance(m_int)
  get_performance(m_int)
}

}
\seealso{
Other main_models: 
\code{\link{rf}()},
\code{\link{rf_spatial}()}
}
\concept{main_models}
