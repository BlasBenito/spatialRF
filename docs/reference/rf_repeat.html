<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fits several random forest models on the same data — rf_repeat • spatialRF</title><script src="../deps/jquery-3.6.1/jquery-3.6.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fits several random forest models on the same data — rf_repeat"><meta name="description" content="Fits several random forest models on the same data in order to capture the effect of the algorithm's stochasticity on the variable importance scores, predictions, residuals, and performance measures. The function relies on the median to aggregate performance and importance values across repetitions. It is recommended to use it after a model is fitted (rf() or rf_spatial()), tuned (rf_tuning()), and/or evaluated (rf_evaluate()). This function is designed to be used after fitting a model with rf() or rf_spatial(), tuning it with rf_tuning() and evaluating it with rf_evaluate()."><meta property="og:description" content="Fits several random forest models on the same data in order to capture the effect of the algorithm's stochasticity on the variable importance scores, predictions, residuals, and performance measures. The function relies on the median to aggregate performance and importance values across repetitions. It is recommended to use it after a model is fitted (rf() or rf_spatial()), tuned (rf_tuning()), and/or evaluated (rf_evaluate()). This function is designed to be used after fitting a model with rf() or rf_spatial(), tuning it with rf_tuning() and evaluating it with rf_evaluate()."><link rel="stylesheet" href="extra.css"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spatialRF</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/non_spatial_models.html">Non-Spatial Random Forest Models</a></li>
    <li><a class="dropdown-item" href="../articles/spatial_models.html">Spatial Random Forest Models</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Development</h6></li>
    <li><a class="dropdown-item" href="../articles/development_roadmap.html">Development Roadmap</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BlasBenito/spatialRF/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fits several random forest models on the same data</h1>
      <small class="dont-index">Source: <a href="https://github.com/BlasBenito/spatialRF/blob/HEAD/R/rf_repeat.R" class="external-link"><code>R/rf_repeat.R</code></a></small>
      <div class="d-none name"><code>rf_repeat.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits several random forest models on the same data in order to capture the effect of the algorithm's stochasticity on the variable importance scores, predictions, residuals, and performance measures. The function relies on the median to aggregate performance and importance values across repetitions. It is recommended to use it after a model is fitted (<code><a href="rf.html">rf()</a></code> or <code><a href="rf_spatial.html">rf_spatial()</a></code>), tuned (<code><a href="rf_tuning.html">rf_tuning()</a></code>), and/or evaluated (<code><a href="rf_evaluate.html">rf_evaluate()</a></code>). This function is designed to be used after fitting a model with <code><a href="rf.html">rf()</a></code> or <code><a href="rf_spatial.html">rf_spatial()</a></code>, tuning it with <code><a href="rf_tuning.html">rf_tuning()</a></code> and evaluating it with <code><a href="rf_evaluate.html">rf_evaluate()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rf_repeat</span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dependent.variable.name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  predictor.variable.names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  distance.matrix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  distance.thresholds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  xy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ranger.arguments <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scaled.importance <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  repetitions <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  keep.models <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  cluster <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A model fitted with <code><a href="rf.html">rf()</a></code>. If provided, the data and ranger arguments are taken directly from the model definition (stored in <code>model$ranger.arguments</code>). Default: <code>NULL</code></p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame with a response variable and a set of predictors. Default: <code>NULL</code></p></dd>


<dt id="arg-dependent-variable-name">dependent.variable.name<a class="anchor" aria-label="anchor" href="#arg-dependent-variable-name"></a></dt>
<dd><p>Character string with the name of the response variable. Must be in the column names of <code>data</code>. If the dependent variable is binary with values 1 and 0, the argument <code>case.weights</code> of <code>ranger</code> is populated by the function <code><a href="case_weights.html">case_weights()</a></code>. Default: <code>NULL</code></p></dd>


<dt id="arg-predictor-variable-names">predictor.variable.names<a class="anchor" aria-label="anchor" href="#arg-predictor-variable-names"></a></dt>
<dd><p>Character vector with the names of the predictive variables. Every element of this vector must be in the column names of <code>data</code>. Default: <code>NULL</code></p></dd>


<dt id="arg-distance-matrix">distance.matrix<a class="anchor" aria-label="anchor" href="#arg-distance-matrix"></a></dt>
<dd><p>Squared matrix with the distances among the records in <code>data</code>. The number of rows of <code>distance.matrix</code> and <code>data</code> must be the same. If not provided, the computation of the Moran's I of the residuals is omitted. Default: <code>NULL</code></p></dd>


<dt id="arg-distance-thresholds">distance.thresholds<a class="anchor" aria-label="anchor" href="#arg-distance-thresholds"></a></dt>
<dd><p>Numeric vector with neighborhood distances. All distances in the distance matrix below each value in <code>dustance.thresholds</code> are set to 0 for the computation of Moran's I. If <code>NULL</code>, it defaults to seq(0, max(distance.matrix), length.out = 4). Default: <code>NULL</code></p></dd>


<dt id="arg-xy">xy<a class="anchor" aria-label="anchor" href="#arg-xy"></a></dt>
<dd><p>(optional) Data frame or matrix with two columns containing coordinates and named "x" and "y". It is not used by this function, but it is stored in the slot <code>ranger.arguments$xy</code> of the model, so it can be used by <code><a href="rf_evaluate.html">rf_evaluate()</a></code> and <code><a href="rf_tuning.html">rf_tuning()</a></code>. Default: <code>NULL</code></p></dd>


<dt id="arg-ranger-arguments">ranger.arguments<a class="anchor" aria-label="anchor" href="#arg-ranger-arguments"></a></dt>
<dd><p>Named list with <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a> arguments (other arguments of this function can also go here). All <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a> arguments are set to their default values except for 'importance', that is set to 'permutation' rather than 'none'. Please, consult the help file of <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a> if you are not familiar with the arguments of this function.</p></dd>


<dt id="arg-scaled-importance">scaled.importance<a class="anchor" aria-label="anchor" href="#arg-scaled-importance"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, and 'importance = "permutation', the function scales 'data' with <a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a> and fits a new model to compute scaled variable importance scores. Default: <code>FALSE</code></p></dd>


<dt id="arg-repetitions">repetitions<a class="anchor" aria-label="anchor" href="#arg-repetitions"></a></dt>
<dd><p>Integer, number of random forest models to fit. Default: <code>10</code></p></dd>


<dt id="arg-keep-models">keep.models<a class="anchor" aria-label="anchor" href="#arg-keep-models"></a></dt>
<dd><p>Logical, if <code>TRUE</code>, the fitted models are returned in the <code>models</code> slot. Set to <code>FALSE</code> if the accumulation of models is creating issues with the RAM memory available. Default: <code>TRUE</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Integer, random seed to facilitate reproduciblity. If set to a given number, the results of the function are always the same. Default: <code>1</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, ff <code>TRUE</code>, messages and plots generated during the execution of the function are displayed, Default: <code>TRUE</code></p></dd>


<dt id="arg-n-cores">n.cores<a class="anchor" aria-label="anchor" href="#arg-n-cores"></a></dt>
<dd><p>Integer, number of cores to use for parallel execution. Creates a socket cluster with <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::makeCluster()</a></code>, runs operations in parallel with <code>foreach</code> and <code>%dopar%</code>, and stops the cluster with <code>parallel::clusterStop()</code> when the job is done. Default: <code>parallel::detectCores() - 1</code></p></dd>


<dt id="arg-cluster">cluster<a class="anchor" aria-label="anchor" href="#arg-cluster"></a></dt>
<dd><p>A cluster definition generated with <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::makeCluster()</a></code>. If provided, overrides <code>n.cores</code>. When <code>cluster = NULL</code> (default value), and <code>model</code> is provided, the cluster in <code>model</code>, if any, is used instead. If this cluster is <code>NULL</code>, then the function uses <code>n.cores</code> instead. The function does not stop a provided cluster, so it should be stopped with <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::stopCluster()</a></code> afterwards. The cluster definition is stored in the output list under the name "cluster" so it can be passed to other functions via the <code>model</code> argument, or using the <code>%&gt;%</code> pipe. Default: <code>NULL</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A ranger model with several new slots:</p><ul><li><p><code>ranger.arguments</code>: Stores the values of the arguments used to fit the ranger model.</p></li>
<li><p><code>importance</code>: A list containing a data frame with the predictors ordered by their importance, a ggplot showing the importance values, and local importance scores.</p></li>
<li><p><code>performance</code>: out-of-bag performance scores: R squared, pseudo R squared, RMSE, and normalized RMSE (NRMSE).</p></li>
<li><p><code>pseudo.r.squared</code>: computed as the correlation between the observations and the predictions.</p></li>
<li><p><code>residuals</code>: residuals, normality test of the residuals computed with <code><a href="normality.html">residuals_test()</a></code>, and spatial autocorrelation of the residuals computed with <code><a href="moran_multithreshold.html">moran_multithreshold()</a></code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other model_workflow:
<code><a href="rf_compare.html">rf_compare()</a></code>,
<code><a href="rf_evaluate.html">rf_evaluate()</a></code>,
<code><a href="rf_importance.html">rf_importance()</a></code>,
<code><a href="rf_tuning.html">rf_tuning()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">plants_rf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">m_repeat</span> <span class="op">&lt;-</span> <span class="fu">rf_repeat</span><span class="op">(</span></span></span>
<span class="r-in"><span>    model <span class="op">=</span> <span class="va">plants_rf</span>,</span></span>
<span class="r-in"><span>    repetitions <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>    n.cores <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#performance scores across repetitions</span></span></span>
<span class="r-in"><span>  <span class="va">m_repeat</span><span class="op">$</span><span class="va">performance</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="print_performance.html">print_performance</a></span><span class="op">(</span><span class="va">m_repeat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#variable importance</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="plot_importance.html">plot_importance</a></span><span class="op">(</span><span class="va">m_repeat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">#response curves</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="plot_response_curves.html">plot_response_curves</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    model <span class="op">=</span> <span class="va">m_repeat</span>,</span></span>
<span class="r-in"><span>    variables <span class="op">=</span> <span class="st">"climate_bio1_average"</span>,</span></span>
<span class="r-in"><span>    quantiles <span class="op">=</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://blasbenito.com" class="external-link">Blas M. Benito</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

