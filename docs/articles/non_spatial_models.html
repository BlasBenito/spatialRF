<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="spatialRF">
<title>Non-Spatial Random Forest Models • spatialRF</title>
<script src="../deps/jquery-3.6.1/jquery-3.6.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Non-Spatial Random Forest Models">
<meta property="og:description" content="spatialRF">
<!-- mathjax --><script src="file:///usr/share/javascript/mathjax/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="extra.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">spatialRF</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Tutorials</h6>
    <a class="dropdown-item" href="../articles/non_spatial_models.html">Non-Spatial Random Forest Models</a>
    <a class="dropdown-item" href="../articles/spatial_models.html">Spatial Random Forest Models</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Development</h6>
    <a class="dropdown-item" href="../articles/development_roadmap.html">Development Roadmap</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/BlasBenito/spatialRF/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Non-Spatial Random Forest Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BlasBenito/spatialRF/blob/HEAD/vignettes/articles/non_spatial_models.Rmd" class="external-link"><code>vignettes/articles/non_spatial_models.Rmd</code></a></small>
      <div class="d-none name"><code>non_spatial_models.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This tutorial demonstrates how to fit and interpret non-spatial
random forest models using the <code>spatialRF</code> package. You’ll
learn how to explore spatial data, find promising variable interactions,
train models, evaluate performance, and understand variable
importance.</p>
<p>If you’re interested in addressing spatial autocorrelation in your
model residuals, see the <a href="spatial_models.html">Spatial Random
Forest Models</a> tutorial.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>The following libraries are required for this tutorial.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://blasbenito.github.io/spatialRF/">spatialRF</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT" class="external-link">DT</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/" class="external-link">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearthdata/" class="external-link">rnaturalearthdata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ModelOriented/randomForestExplainer" class="external-link">randomForestExplainer</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bgreenwell/pdp" class="external-link">pdp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<p>Many functions in the package also support a parallelization backend
to speed-up execution.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span></span>
<span>  <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"PSOCK"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The package includes an example dataset that fulfills the conditions
mentioned above, named <a href="https://blasbenito.github.io/spatialRF/reference/plants_df.html"><code>plants_df</code></a>.
It is a data frame with plant species richness and predictors for 227
ecoregions in the Americas, and a distance matrix among the ecoregion
edges named, well, <a href="https://blasbenito.github.io/spatialRF/reference/plants_distance.html"><code>plants_distance</code></a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span></span>
<span>  <span class="va">plants_df</span>,         <span class="co">#training data frame</span></span>
<span>  <span class="va">plants_response</span>,   <span class="co">#response name</span></span>
<span>  <span class="va">plants_predictors</span>, <span class="co">#predictors names</span></span>
<span>  <span class="va">plants_distance</span>,   <span class="co">#distance matrix in km</span></span>
<span>  <span class="va">plants_xy</span>          <span class="co">#case coordinates of plants_df</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#distance thresholds (same units as plants_distance)</span></span>
<span><span class="co">#used to assess spatial correlation at different distances</span></span>
<span><span class="va">distance.thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">1000</span>, <span class="fl">2000</span>, <span class="fl">4000</span>, <span class="fl">8000</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#a pretty color palette</span></span>
<span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    palette <span class="op">=</span> <span class="st">"Zissou 1"</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>The figure below shows the response variable in space.</p>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
<p>The predictors (columns 5 to 21) represent diverse factors that may
influence plant richness such as sampling bias, the area of the
ecoregion, climatic variables, human presence and impact, topography,
geographical fragmentation, and features of the neighbors of each
ecoregion.</p>
<p>The figure below shows the scatterplots of the response variable (y
axis) against each predictor (x axis).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_training_df.html">plot_training_df</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">plants_df</span>,</span>
<span>  dependent.variable.name <span class="op">=</span> <span class="va">plants_response</span>,</span>
<span>  predictor.variable.names <span class="op">=</span> <span class="va">plants_predictors</span>,</span>
<span>  point.color <span class="op">=</span> <span class="va">colors</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<p>The function <a href="https://blasbenito.github.io/spatialRF/reference/plot_training_df_moran.html"><code>plot_training_df_moran()</code></a>
shows the spatial autocorrelation of the response and the predictors
across different distance thresholds. Low Moran’s I and p-values equal
to or larger than 0.05 indicate that there is no spatial autocorrelation
for the given variable and distance threshold.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_training_df_moran.html">plot_training_df_moran</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">plants_df</span>,</span>
<span>  dependent.variable.name <span class="op">=</span> <span class="va">plants_response</span>,</span>
<span>  predictor.variable.names <span class="op">=</span> <span class="va">plants_predictors</span>,</span>
<span>  distance.matrix <span class="op">=</span> <span class="va">plants_distance</span>,</span>
<span>  distance.thresholds <span class="op">=</span> <span class="va">distance.thresholds</span>,</span>
<span>  fill.color <span class="op">=</span> <span class="va">colors</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="finding-promising-variable-interactions">Finding promising variable interactions<a class="anchor" aria-label="anchor" href="#finding-promising-variable-interactions"></a>
</h2>
<p>The function <a href="https://blasbenito.github.io/spatialRF/reference/the_feature_engineer.html"><code>the_feature_engineer()</code></a>
tests all possible interactions between the most important predictors,
and selects the most promising ones via spatial cross-validation (see <a href="https://blasbenito.github.io/spatialRF/reference/rf_evaluate.html"><code>rf_evaluate()</code></a>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interactions</span> <span class="op">&lt;-</span> <span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/the_feature_engineer.html">the_feature_engineer</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">plants_df</span>,</span>
<span>  dependent.variable.name <span class="op">=</span> <span class="va">plants_response</span>,</span>
<span>  predictor.variable.names <span class="op">=</span> <span class="va">plants_predictors</span>,</span>
<span>  xy <span class="op">=</span> <span class="va">plants_xy</span>,</span>
<span>  importance.threshold <span class="op">=</span> <span class="fl">0.50</span>, <span class="co">#selects interactions above 50% importance</span></span>
<span>  cor.threshold <span class="op">=</span> <span class="fl">0.60</span>, <span class="co">#max correlation between interactions and predictors</span></span>
<span>  repetitions <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  cluster <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>  point.color <span class="op">=</span> <span class="va">colors</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt;  ┌──────────────────┬──────────────────┬──────────────────┬──────────────────┐</span></span>
<span><span class="co">#&gt;  │ <span style="font-weight: bold;">Interaction     </span> │ <span style="font-weight: bold;">Importance (% of</span> │ <span style="font-weight: bold;">       R-squared</span> │ <span style="font-weight: bold;">    Max cor with</span> │</span></span>
<span><span class="co">#&gt;  │                  │ <span style="font-weight: bold;">            max)</span> │ <span style="font-weight: bold;">     improvement</span> │ <span style="font-weight: bold;">      predictors</span> │</span></span>
<span><span class="co">#&gt;  ├──────────────────┼──────────────────┼──────────────────┼──────────────────┤</span></span>
<span><span class="co">#&gt;  │ bias_area_km2..x │             60.1 │            0.086 │             0.60 │</span></span>
<span><span class="co">#&gt;  │ ..bias_species_p │                  │                  │                  │</span></span>
<span><span class="co">#&gt;  │ er_record        │                  │                  │                  │</span></span>
<span><span class="co">#&gt;  ├──────────────────┼──────────────────┼──────────────────┼──────────────────┤</span></span>
<span><span class="co">#&gt;  │ climate_bio1_ave │             83.1 │            0.052 │             0.38 │</span></span>
<span><span class="co">#&gt;  │ rage..pca..human │                  │                  │                  │</span></span>
<span><span class="co">#&gt;  │ _footprint_avera │                  │                  │                  │</span></span>
<span><span class="co">#&gt;  │ ge               │                  │                  │                  │</span></span>
<span><span class="co">#&gt;  ├──────────────────┼──────────────────┼──────────────────┼──────────────────┤</span></span>
<span><span class="co">#&gt;  │ climate_bio1_ave │             84.2 │            0.047 │             0.24 │</span></span>
<span><span class="co">#&gt;  │ rage..pca..neigh │                  │                  │                  │</span></span>
<span><span class="co">#&gt;  │ bors_count       │                  │                  │                  │</span></span>
<span><span class="co">#&gt;  └──────────────────┴──────────────────┴──────────────────┴──────────────────┘</span></span></code></pre></div>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
<p>The resulting plot shows the selected interactions against the
response, the model improvement they produce, their importance relative
to the other predictors, and maximum correlation with the other
predictors.</p>
<p>The violin-plot shows the cross-validation comparison of the model
with and without the selected interactions.</p>
<p>The function also returns a data frame with the complete screening
results.</p>
<table class="table">
<colgroup>
<col width="28%">
<col width="12%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="4%">
</colgroup>
<thead><tr>
<th align="left">interaction.name</th>
<th align="right">interaction.importance</th>
<th align="right">interaction.metric.gain</th>
<th align="right">max.cor.with.predictors</th>
<th align="left">variable.a.name</th>
<th align="left">variable.b.name</th>
<th align="left">selected</th>
</tr></thead>
<tbody>
<tr>
<td align="left">bias_area_km2..x..bias_species_per_record</td>
<td align="right">60.055</td>
<td align="right">0.086</td>
<td align="right">0.5962899</td>
<td align="left">bias_area_km2</td>
<td align="left">bias_species_per_record</td>
<td align="left">TRUE</td>
</tr>
<tr>
<td align="left">climate_bio1_average..pca..human_footprint_average</td>
<td align="right">83.100</td>
<td align="right">0.052</td>
<td align="right">0.3800000</td>
<td align="left">climate_bio1_average</td>
<td align="left">human_footprint_average</td>
<td align="left">TRUE</td>
</tr>
<tr>
<td align="left">climate_bio1_average..pca..human_population_density</td>
<td align="right">87.290</td>
<td align="right">0.055</td>
<td align="right">0.3400000</td>
<td align="left">climate_bio1_average</td>
<td align="left">human_population_density</td>
<td align="left">TRUE</td>
</tr>
<tr>
<td align="left">human_population..x..bias_species_per_record</td>
<td align="right">65.215</td>
<td align="right">-0.002</td>
<td align="right">0.5462406</td>
<td align="left">human_population</td>
<td align="left">bias_species_per_record</td>
<td align="left">FALSE</td>
</tr>
<tr>
<td align="left">climate_bio1_average..pca..neighbors_count</td>
<td align="right">84.180</td>
<td align="right">0.047</td>
<td align="right">0.2400000</td>
<td align="left">climate_bio1_average</td>
<td align="left">neighbors_count</td>
<td align="left">TRUE</td>
</tr>
<tr>
<td align="left">climate_hypervolume..x..human_population_density</td>
<td align="right">51.442</td>
<td align="right">-0.016</td>
<td align="right">0.5599486</td>
<td align="left">climate_hypervolume</td>
<td align="left">human_population_density</td>
<td align="left">FALSE</td>
</tr>
<tr>
<td align="left">climate_bio1_average..pca..bias_species_per_record</td>
<td align="right">70.060</td>
<td align="right">0.000</td>
<td align="right">0.3500000</td>
<td align="left">climate_bio1_average</td>
<td align="left">bias_species_per_record</td>
<td align="left">FALSE</td>
</tr>
<tr>
<td align="left">bias_area_km2..pca..neighbors_area</td>
<td align="right">58.190</td>
<td align="right">0.001</td>
<td align="right">0.4000000</td>
<td align="left">bias_area_km2</td>
<td align="left">neighbors_area</td>
<td align="left">FALSE</td>
</tr>
<tr>
<td align="left">human_footprint_average..x..neighbors_area</td>
<td align="right">25.243</td>
<td align="right">0.001</td>
<td align="right">0.5813854</td>
<td align="left">human_footprint_average</td>
<td align="left">neighbors_area</td>
<td align="left">FALSE</td>
</tr>
<tr>
<td align="left">bias_area_km2..pca..neighbors_count</td>
<td align="right">53.000</td>
<td align="right">0.008</td>
<td align="right">0.2500000</td>
<td align="left">bias_area_km2</td>
<td align="left">neighbors_count</td>
<td align="left">FALSE</td>
</tr>
<tr>
<td align="left">neighbors_count..pca..neighbors_area</td>
<td align="right">52.180</td>
<td align="right">-0.006</td>
<td align="right">0.2900000</td>
<td align="left">neighbors_count</td>
<td align="left">neighbors_area</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#adding interaction column to the training data</span></span>
<span><span class="va">plants_df</span> <span class="op">&lt;-</span> <span class="va">interactions</span><span class="op">$</span><span class="va">data</span></span>
<span></span>
<span><span class="co">#adding interaction name to predictor.variable.names</span></span>
<span><span class="va">plants_predictors</span> <span class="op">&lt;-</span> <span class="va">interactions</span><span class="op">$</span><span class="va">predictor.variable.names</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="training-a-non-spatial-random-forest-model-with-rf">Training a non-spatial Random Forest model with
<code>rf()</code><a class="anchor" aria-label="anchor" href="#training-a-non-spatial-random-forest-model-with-rf"></a>
</h2>
<p>The function <a href="https://blasbenito.github.io/spatialRF/reference/rf.html"><code>rf()</code></a>
is a convenient wrapper for <code><a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger::ranger()</a></code> used in every
modelling function of the <em>spatialRF</em> package.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.non.spatial</span> <span class="op">&lt;-</span> <span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/rf.html">rf</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">plants_df</span>,</span>
<span>  dependent.variable.name <span class="op">=</span> <span class="va">plants_response</span>,</span>
<span>  predictor.variable.names <span class="op">=</span> <span class="va">plants_predictors</span>,</span>
<span>  distance.matrix <span class="op">=</span> <span class="va">plants_distance</span>,</span>
<span>  distance.thresholds <span class="op">=</span> <span class="va">distance.thresholds</span>,</span>
<span>  xy <span class="op">=</span> <span class="va">plants_xy</span>, <span class="co">#rf does not use it, but passes it along</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The output is a list with several slots containing the information
required to interpret the model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model.non.spatial</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "predictions"               "num.trees"                </span></span>
<span><span class="co">#&gt;  [3] "num.independent.variables" "mtry"                     </span></span>
<span><span class="co">#&gt;  [5] "min.node.size"             "variable.importance"      </span></span>
<span><span class="co">#&gt;  [7] "variable.importance.local" "prediction.error"         </span></span>
<span><span class="co">#&gt;  [9] "forest"                    "splitrule"                </span></span>
<span><span class="co">#&gt; [11] "treetype"                  "r.squared"                </span></span>
<span><span class="co">#&gt; [13] "call"                      "importance.mode"          </span></span>
<span><span class="co">#&gt; [15] "num.samples"               "replace"                  </span></span>
<span><span class="co">#&gt; [17] "dependent.variable.name"   "max.depth"                </span></span>
<span><span class="co">#&gt; [19] "ranger.arguments"          "importance"               </span></span>
<span><span class="co">#&gt; [21] "performance"               "residuals"</span></span></code></pre></div>
<p>The information available in these slots can be plotted (functions
named <code>plot_...()</code>), printed to screen
(<code>print_...()</code>) and captured for further analyses
(<code>get_...()</code>).</p>
<p>The resulting object has its own <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> method.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.non.spatial</span></span>
<span><span class="co">#&gt; Model type</span></span>
<span><span class="co">#&gt;   - Fitted with:                     ranger()</span></span>
<span><span class="co">#&gt;   - Response variable:               richness_species_vascular</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random forest parameters</span></span>
<span><span class="co">#&gt;   - Type:                            Regression</span></span>
<span><span class="co">#&gt;   - Number of trees:                 500</span></span>
<span><span class="co">#&gt;   - Sample size:                     227</span></span>
<span><span class="co">#&gt;   - Number of predictors:            20</span></span>
<span><span class="co">#&gt;   - Mtry:                            4</span></span>
<span><span class="co">#&gt;   - Minimum node size:               5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model performance </span></span>
<span><span class="co">#&gt;   - R squared (oob):                  0.6138982</span></span>
<span><span class="co">#&gt;   - R squared (cor(obs, pred)^2):     0.9556808</span></span>
<span><span class="co">#&gt;   - Pseudo R squared (cor(obs, pred)):0.9775893</span></span>
<span><span class="co">#&gt;   - RMSE (oob):                       2094.047</span></span>
<span><span class="co">#&gt;   - RMSE:                             904.7265</span></span>
<span><span class="co">#&gt;   - Normalized RMSE:                  0.2611797</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model residuals </span></span>
<span><span class="co">#&gt;   - Stats: </span></span>
<span><span class="co">#&gt;           ┌──────────┬─────────┬─────────┬────────┬────────┬─────────┐</span></span>
<span><span class="co">#&gt;           │ <span style="font-weight: bold;">Min.    </span> │ <span style="font-weight: bold;">1st Q. </span> │ <span style="font-weight: bold;">Median </span> │ <span style="font-weight: bold;">Mean  </span> │ <span style="font-weight: bold;">3rd Q.</span> │ <span style="font-weight: bold;">Max.   </span> │</span></span>
<span><span class="co">#&gt;           ├──────────┼─────────┼─────────┼────────┼────────┼─────────┤</span></span>
<span><span class="co">#&gt;           │ -2082.08 │ -461.22 │ -139.59 │ -24.45 │ 128.29 │ 7234.00 │</span></span>
<span><span class="co">#&gt;           └──────────┴─────────┴─────────┴────────┴────────┴─────────┘</span></span>
<span><span class="co">#&gt;   - Normality: </span></span>
<span><span class="co">#&gt;       - Shapiro-Wilks W: 0.785 </span></span>
<span><span class="co">#&gt;       - p-value        : 0 </span></span>
<span><span class="co">#&gt;       - Interpretation : Residuals are not normal </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   - Spatial autocorrelation: </span></span>
<span><span class="co">#&gt;              ┌──────────┬───────────┬─────────┬──────────────────┐</span></span>
<span><span class="co">#&gt;              │ <span style="font-weight: bold;">Distance</span> │ <span style="font-weight: bold;">Moran's I</span> │ <span style="font-weight: bold;">P value</span> │ <span style="font-weight: bold;">Interpretation  </span> │</span></span>
<span><span class="co">#&gt;              ├──────────┼───────────┼─────────┼──────────────────┤</span></span>
<span><span class="co">#&gt;              │     10.0 │     0.097 │   0.004 │ Positive spatial │</span></span>
<span><span class="co">#&gt;              │          │           │         │ correlation      │</span></span>
<span><span class="co">#&gt;              ├──────────┼───────────┼─────────┼──────────────────┤</span></span>
<span><span class="co">#&gt;              │    100.0 │     0.068 │   0.018 │ Positive spatial │</span></span>
<span><span class="co">#&gt;              │          │           │         │ correlation      │</span></span>
<span><span class="co">#&gt;              ├──────────┼───────────┼─────────┼──────────────────┤</span></span>
<span><span class="co">#&gt;              │   1000.0 │     0.037 │   0.006 │ Positive spatial │</span></span>
<span><span class="co">#&gt;              │          │           │         │ correlation      │</span></span>
<span><span class="co">#&gt;              ├──────────┼───────────┼─────────┼──────────────────┤</span></span>
<span><span class="co">#&gt;              │   2000.0 │     0.014 │   0.064 │ No spatial       │</span></span>
<span><span class="co">#&gt;              │          │           │         │ correlation      │</span></span>
<span><span class="co">#&gt;              ├──────────┼───────────┼─────────┼──────────────────┤</span></span>
<span><span class="co">#&gt;              │   4000.0 │    -0.002 │   0.720 │ No spatial       │</span></span>
<span><span class="co">#&gt;              │          │           │         │ correlation      │</span></span>
<span><span class="co">#&gt;              ├──────────┼───────────┼─────────┼──────────────────┤</span></span>
<span><span class="co">#&gt;              │   8000.0 │    -0.003 │   0.369 │ No spatial       │</span></span>
<span><span class="co">#&gt;              │          │           │         │ correlation      │</span></span>
<span><span class="co">#&gt;              └──────────┴───────────┴─────────┴──────────────────┘</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variable importance: </span></span>
<span><span class="co">#&gt;              ┌──────────────────────────────────────┬────────────┐</span></span>
<span><span class="co">#&gt;              │ <span style="font-weight: bold;">Variable                            </span> │ <span style="font-weight: bold;">Importance</span> │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ human_population                     │   1546.451 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ climate_bio1_average..pca..neighbors │   1379.388 │</span></span>
<span><span class="co">#&gt;              │ _count                               │            │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ climate_bio1_average                 │   1306.028 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ climate_hypervolume                  │   1239.198 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ climate_bio1_average..pca..human_foo │   1223.748 │</span></span>
<span><span class="co">#&gt;              │ tprint_average                       │            │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ human_population_density             │   1074.501 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ bias_area_km2                        │   1016.191 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ bias_area_km2..x..bias_species_per_r │    961.853 │</span></span>
<span><span class="co">#&gt;              │ ecord                                │            │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ bias_species_per_record              │    852.832 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ human_footprint_average              │    831.300 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ neighbors_count                      │    695.811 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ neighbors_area                       │    655.310 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ topography_elevation_average         │    626.337 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ climate_aridity_index_average        │    521.059 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ climate_velocity_lgm_average         │    517.754 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ neighbors_percent_shared_edge        │    501.732 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ fragmentation_cohesion               │    443.694 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ fragmentation_division               │    339.893 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ landcover_herbs_percent_average      │    327.623 │</span></span>
<span><span class="co">#&gt;              ├──────────────────────────────────────┼────────────┤</span></span>
<span><span class="co">#&gt;              │ climate_bio15_minimum                │    256.894 │</span></span>
<span><span class="co">#&gt;              └──────────────────────────────────────┴────────────┘</span></span></code></pre></div>
<div class="section level3">
<h3 id="residuals">Residuals<a class="anchor" aria-label="anchor" href="#residuals"></a>
</h3>
<p>The object <strong>residuals</strong>
(<code>model.non.spatial$residuals</code>) stores the normality and
spatial autocorrelation tests.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_residuals_diagnostics.html">plot_residuals_diagnostics</a></span><span class="op">(</span></span>
<span>  <span class="va">model.non.spatial</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  point.color <span class="op">=</span> <span class="va">colors</span>,</span>
<span>  fill.color <span class="op">=</span> <span class="va">colors</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-14-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="variable-importance">Variable importance<a class="anchor" aria-label="anchor" href="#variable-importance"></a>
</h3>
<div class="section level4">
<h4 id="global-variable-importance">Global variable importance<a class="anchor" aria-label="anchor" href="#global-variable-importance"></a>
</h4>
<p>The object <strong>importance</strong> in
<code>model.non.spatial$importance</code>) contains the variable
importance scores. These can be plotted with <a href="https://blasbenito.github.io/spatialRF/reference/plot_importance.html"><code>plot_importance()</code></a>,
printed with <a href="https://blasbenito.github.io/spatialRF/reference/print_importance.html"><code>print_importance()</code></a>,
and the dataframe retrieved with <a href="https://blasbenito.github.io/spatialRF/reference/get_importance.html"><code>get_importance()</code></a></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_importance.html">plot_importance</a></span><span class="op">(</span></span>
<span>  <span class="va">model.non.spatial</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fill.color <span class="op">=</span> <span class="va">colors</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-15-1.png" width="100%"></p>
<p>The output of <code><a href="../reference/rf.html">rf()</a></code> is compatible with
<code><a href="https://rdrr.io/pkg/randomForestExplainer/man/measure_importance.html" class="external-link">randomForestExplainer::measure_importance()</a></code>, which helps
deepen our understanding on variable importance scores.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">importance.df</span> <span class="op">&lt;-</span> <span class="fu">randomForestExplainer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/randomForestExplainer/man/measure_importance.html" class="external-link">measure_importance</a></span><span class="op">(</span></span>
<span>  <span class="va">model.non.spatial</span>,</span>
<span>  measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean_min_depth"</span>, <span class="st">"no_of_nodes"</span>, <span class="st">"times_a_root"</span>, <span class="st">"p_value"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="51%">
<col width="15%">
<col width="12%">
<col width="13%">
<col width="8%">
</colgroup>
<thead><tr>
<th align="left">variable</th>
<th align="right">mean_min_depth</th>
<th align="right">no_of_nodes</th>
<th align="right">times_a_root</th>
<th align="right">p_value</th>
</tr></thead>
<tbody>
<tr>
<td align="left">bias_area_km2</td>
<td align="right">3.95</td>
<td align="right">1894</td>
<td align="right">12</td>
<td align="right">0.24</td>
</tr>
<tr>
<td align="left">bias_area_km2..x..bias_species_per_record</td>
<td align="right">2.99</td>
<td align="right">1978</td>
<td align="right">72</td>
<td align="right">0.00</td>
</tr>
<tr>
<td align="left">bias_species_per_record</td>
<td align="right">3.64</td>
<td align="right">2464</td>
<td align="right">5</td>
<td align="right">0.00</td>
</tr>
<tr>
<td align="left">climate_aridity_index_average</td>
<td align="right">4.69</td>
<td align="right">1723</td>
<td align="right">4</td>
<td align="right">1.00</td>
</tr>
<tr>
<td align="left">climate_bio1_average</td>
<td align="right">3.06</td>
<td align="right">2039</td>
<td align="right">59</td>
<td align="right">0.00</td>
</tr>
<tr>
<td align="left">climate_bio1_average..pca..human_footprint_average</td>
<td align="right">3.46</td>
<td align="right">1825</td>
<td align="right">49</td>
<td align="right">0.83</td>
</tr>
<tr>
<td align="left">climate_bio1_average..pca..neighbors_count</td>
<td align="right">2.56</td>
<td align="right">2281</td>
<td align="right">85</td>
<td align="right">0.00</td>
</tr>
<tr>
<td align="left">climate_bio15_minimum</td>
<td align="right">4.94</td>
<td align="right">1611</td>
<td align="right">0</td>
<td align="right">1.00</td>
</tr>
<tr>
<td align="left">climate_hypervolume</td>
<td align="right">3.25</td>
<td align="right">2041</td>
<td align="right">43</td>
<td align="right">0.00</td>
</tr>
<tr>
<td align="left">climate_velocity_lgm_average</td>
<td align="right">4.71</td>
<td align="right">1684</td>
<td align="right">10</td>
<td align="right">1.00</td>
</tr>
<tr>
<td align="left">fragmentation_cohesion</td>
<td align="right">4.72</td>
<td align="right">1610</td>
<td align="right">12</td>
<td align="right">1.00</td>
</tr>
<tr>
<td align="left">fragmentation_division</td>
<td align="right">5.27</td>
<td align="right">1480</td>
<td align="right">1</td>
<td align="right">1.00</td>
</tr>
<tr>
<td align="left">human_footprint_average</td>
<td align="right">4.57</td>
<td align="right">1612</td>
<td align="right">8</td>
<td align="right">1.00</td>
</tr>
<tr>
<td align="left">human_population</td>
<td align="right">2.59</td>
<td align="right">2279</td>
<td align="right">64</td>
<td align="right">0.00</td>
</tr>
<tr>
<td align="left">human_population_density</td>
<td align="right">3.50</td>
<td align="right">1997</td>
<td align="right">32</td>
<td align="right">0.00</td>
</tr>
<tr>
<td align="left">landcover_herbs_percent_average</td>
<td align="right">4.82</td>
<td align="right">1814</td>
<td align="right">0</td>
<td align="right">0.89</td>
</tr>
<tr>
<td align="left">neighbors_area</td>
<td align="right">4.45</td>
<td align="right">1723</td>
<td align="right">1</td>
<td align="right">1.00</td>
</tr>
<tr>
<td align="left">neighbors_count</td>
<td align="right">4.03</td>
<td align="right">1502</td>
<td align="right">36</td>
<td align="right">1.00</td>
</tr>
<tr>
<td align="left">neighbors_percent_shared_edge</td>
<td align="right">4.29</td>
<td align="right">1801</td>
<td align="right">7</td>
<td align="right">0.93</td>
</tr>
<tr>
<td align="left">topography_elevation_average</td>
<td align="right">4.17</td>
<td align="right">1921</td>
<td align="right">0</td>
<td align="right">0.09</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="contribution-of-predictors-to-model-transferability">Contribution of predictors to model transferability<a class="anchor" aria-label="anchor" href="#contribution-of-predictors-to-model-transferability"></a>
</h4>
<p>The function <a href="https://blasbenito.github.io/spatialRF/reference/rf_importance.html"><code>rf_importance()</code></a>
assesses how each predictor contributes to model transferability by
combining leave-one-predictor-out with spatial cross-validation.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.non.spatial</span> <span class="op">&lt;-</span> <span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/rf_importance.html">rf_importance</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">model.non.spatial</span>,</span>
<span>  cluster <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>  fill.color <span class="op">=</span> <span class="va">colors</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-18-1.png" width="100%"></p>
<p>The plot, stored at
<code>model.non.spatial$importance$cv.per.variable.plot</code>, shows
the predictors with a positive net effect in model transferability. The
values in the plot are added as new columns with the suffix
<code>.cv</code> in the dataframe
<code>model.non.spatial$importance$per.variable</code>.</p>
<table class="table">
<colgroup>
<col width="34%">
<col width="10%">
<col width="9%">
<col width="12%">
<col width="15%">
<col width="17%">
</colgroup>
<thead><tr>
<th align="left">variable</th>
<th align="right">importance.oob</th>
<th align="right">importance.cv</th>
<th align="right">importance.cv.mad</th>
<th align="right">importance.cv.percent</th>
<th align="right">importance.cv.percent.mad</th>
</tr></thead>
<tbody>
<tr>
<td align="left">human_population</td>
<td align="right">1546.451</td>
<td align="right">0.001</td>
<td align="right">0.039</td>
<td align="right">0.2</td>
<td align="right">12.6</td>
</tr>
<tr>
<td align="left">climate_bio1_average..pca..neighbors_count</td>
<td align="right">1379.388</td>
<td align="right">0.000</td>
<td align="right">0.030</td>
<td align="right">0.0</td>
<td align="right">9.7</td>
</tr>
<tr>
<td align="left">climate_bio1_average</td>
<td align="right">1306.028</td>
<td align="right">0.019</td>
<td align="right">0.018</td>
<td align="right">3.7</td>
<td align="right">5.8</td>
</tr>
<tr>
<td align="left">climate_hypervolume</td>
<td align="right">1239.198</td>
<td align="right">0.037</td>
<td align="right">0.033</td>
<td align="right">7.3</td>
<td align="right">10.7</td>
</tr>
<tr>
<td align="left">climate_bio1_average..pca..human_footprint_average</td>
<td align="right">1223.748</td>
<td align="right">0.027</td>
<td align="right">0.018</td>
<td align="right">5.3</td>
<td align="right">5.8</td>
</tr>
<tr>
<td align="left">human_population_density</td>
<td align="right">1074.501</td>
<td align="right">-0.005</td>
<td align="right">0.018</td>
<td align="right">-1.0</td>
<td align="right">5.8</td>
</tr>
<tr>
<td align="left">bias_area_km2</td>
<td align="right">1016.191</td>
<td align="right">0.012</td>
<td align="right">0.019</td>
<td align="right">2.4</td>
<td align="right">6.3</td>
</tr>
<tr>
<td align="left">bias_area_km2..x..bias_species_per_record</td>
<td align="right">961.853</td>
<td align="right">0.078</td>
<td align="right">0.010</td>
<td align="right">15.4</td>
<td align="right">3.4</td>
</tr>
<tr>
<td align="left">bias_species_per_record</td>
<td align="right">852.832</td>
<td align="right">0.011</td>
<td align="right">0.021</td>
<td align="right">2.2</td>
<td align="right">6.8</td>
</tr>
<tr>
<td align="left">human_footprint_average</td>
<td align="right">831.300</td>
<td align="right">-0.012</td>
<td align="right">0.015</td>
<td align="right">-2.4</td>
<td align="right">4.9</td>
</tr>
<tr>
<td align="left">neighbors_count</td>
<td align="right">695.811</td>
<td align="right">-0.018</td>
<td align="right">0.033</td>
<td align="right">-3.5</td>
<td align="right">10.7</td>
</tr>
<tr>
<td align="left">neighbors_area</td>
<td align="right">655.310</td>
<td align="right">0.008</td>
<td align="right">0.033</td>
<td align="right">1.6</td>
<td align="right">10.7</td>
</tr>
<tr>
<td align="left">topography_elevation_average</td>
<td align="right">626.337</td>
<td align="right">-0.020</td>
<td align="right">0.025</td>
<td align="right">-3.9</td>
<td align="right">8.3</td>
</tr>
<tr>
<td align="left">climate_aridity_index_average</td>
<td align="right">521.059</td>
<td align="right">0.003</td>
<td align="right">0.030</td>
<td align="right">0.6</td>
<td align="right">9.7</td>
</tr>
<tr>
<td align="left">climate_velocity_lgm_average</td>
<td align="right">517.754</td>
<td align="right">-0.005</td>
<td align="right">0.019</td>
<td align="right">-1.0</td>
<td align="right">6.3</td>
</tr>
<tr>
<td align="left">neighbors_percent_shared_edge</td>
<td align="right">501.732</td>
<td align="right">0.005</td>
<td align="right">0.022</td>
<td align="right">1.0</td>
<td align="right">7.3</td>
</tr>
<tr>
<td align="left">fragmentation_cohesion</td>
<td align="right">443.694</td>
<td align="right">-0.022</td>
<td align="right">0.016</td>
<td align="right">-4.3</td>
<td align="right">5.3</td>
</tr>
<tr>
<td align="left">fragmentation_division</td>
<td align="right">339.893</td>
<td align="right">-0.001</td>
<td align="right">0.016</td>
<td align="right">-0.2</td>
<td align="right">5.3</td>
</tr>
<tr>
<td align="left">landcover_herbs_percent_average</td>
<td align="right">327.623</td>
<td align="right">-0.019</td>
<td align="right">0.018</td>
<td align="right">-3.7</td>
<td align="right">5.8</td>
</tr>
<tr>
<td align="left">climate_bio15_minimum</td>
<td align="right">256.894</td>
<td align="right">-0.019</td>
<td align="right">0.028</td>
<td align="right">-3.7</td>
<td align="right">9.2</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="local-variable-importance">Local variable importance<a class="anchor" aria-label="anchor" href="#local-variable-importance"></a>
</h4>
<p>The <code><a href="../reference/rf.html">rf()</a></code> function computes local importance as a
case-by-case average increase in error when a predictor is permuted.
This dataframe, stored at
<code>model.non.spatial$importance$local</code>, can be retrieved with
<a href="https://blasbenito.github.io/spatialRF/reference/get_importance_local.html"><code>get_importance_local()</code></a>
and used to map local importance.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">local.importance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">plants_xy</span>,</span>
<span>  <span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/get_importance_local.html">get_importance_local</a></span><span class="op">(</span><span class="va">model.non.spatial</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-21-1.png" width="100%"></p>
<p>In these maps, a value lower than 0 indicates that the influence of
the predictor on the local prediction is worse than what is expected by
chance.</p>
</div>
</div>
<div class="section level3">
<h3 id="response-curves-and-surfaces">Response curves and surfaces<a class="anchor" aria-label="anchor" href="#response-curves-and-surfaces"></a>
</h3>
<p>The response curve of a predictor is computed by setting the other
predictors to a given quantile or quantiles (0.1, 0.5, and 0.9 by
default).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_response_curves.html">plot_response_curves</a></span><span class="op">(</span></span>
<span>  <span class="va">model.non.spatial</span>,</span>
<span>  quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  line.color <span class="op">=</span> <span class="va">colors</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  show.data <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-22-1.png" width="100%">
For example, the blue curve (quantile 0.1) shows the prediction for each
predictor when all other predictors have low values, while the red curve
(quantile 0.9) shows predictions when all other predictors have high
values.</p>
<p>Setting the argument <code>quantiles</code> to 0.5 and setting
<code>show.data</code> to <code>FALSE</code> (default option)
accentuates the shape of the response curves.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_response_curves.html">plot_response_curves</a></span><span class="op">(</span></span>
<span>  <span class="va">model.non.spatial</span>,</span>
<span>  quantiles <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  line.color <span class="op">=</span> <span class="va">colors</span><span class="op">[</span><span class="fl">100</span><span class="op">]</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-23-1.png" width="100%"></p>
<p>If you need to do your own plots, the function <a href="https://blasbenito.github.io/spatialRF/reference/get_response_curves.html"><code>get_response_curves()</code></a>
returns a data frame with the required data.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">response.curves.df</span> <span class="op">&lt;-</span> <span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/get_response_curves.html">get_response_curves</a></span><span class="op">(</span><span class="va">model.non.spatial</span><span class="op">)</span></span></code></pre></div>
<p>Interactions between two predictors can be plotted with <a href="https://blasbenito.github.io/spatialRF/reference/plot_response_surface.html"><code>plot_response_surface()</code></a>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_response_surface.html">plot_response_surface</a></span><span class="op">(</span></span>
<span>  <span class="va">model.non.spatial</span>,</span>
<span>  a <span class="op">=</span> <span class="st">"climate_bio1_average"</span>,</span>
<span>  b <span class="op">=</span> <span class="st">"neighbors_count"</span>,</span>
<span>  fill.color <span class="op">=</span> <span class="va">colors</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-25-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="model-performance">Model performance<a class="anchor" aria-label="anchor" href="#model-performance"></a>
</h3>
<p>The <strong>performance</strong> slot, stored at
<code>model.non.spatial$performance</code>, contains the values of
several performance measures. It be printed via the function <a href="https://blasbenito.github.io/spatialRF/reference/print_performance.html"><code>print_performance()</code></a>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/print_performance.html">print_performance</a></span><span class="op">(</span><span class="va">model.non.spatial</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model performance </span></span>
<span><span class="co">#&gt;   - R squared (oob):                  0.6138982</span></span>
<span><span class="co">#&gt;   - R squared (cor(obs, pred)^2):     0.9556808</span></span>
<span><span class="co">#&gt;   - Pseudo R squared (cor(obs, pred)):0.9775893</span></span>
<span><span class="co">#&gt;   - RMSE (oob):                       2094.047</span></span>
<span><span class="co">#&gt;   - RMSE:                             904.7265</span></span>
<span><span class="co">#&gt;   - Normalized RMSE:                  0.2611797</span></span></code></pre></div>
<ul>
<li>
<code>R squared (oob)</code> and <code>RMSE (oob)</code> are
computed by <code><a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger::ranger()</a></code> on the out-of-bag data
(fraction of data not used to train individual trees). From all the
values available in the <code>performance</code> slot, these are
probably the most honest ones. However, out-of-bag data is not fully
independent, and therefore will still be inflated, especially if the
data is highly aggregated in space.</li>
<li>
<code>R squared</code> and <code>pseudo R squared</code> are
computed from comparing all observations against predictions. These
values will usually be high when spatial autocorrelation is high.</li>
<li>The <code>RMSE</code> and its normalized version are linear with
<code>R squared</code> and <code>pseudo R squared</code>.</li>
</ul>
</div>
<div class="section level3">
<h3 id="spatial-cross-validation">Spatial cross-validation<a class="anchor" aria-label="anchor" href="#spatial-cross-validation"></a>
</h3>
<p>The function <a href="https://blasbenito.github.io/spatialRF/reference/rf_evaluate.html">rf_evaluate()</a>
provides honest performance scores based on <em>spatial
cross-validation</em>. The function separates the data into spatially
independent training and testing folds.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.non.spatial</span> <span class="op">&lt;-</span> <span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/rf_evaluate.html">rf_evaluate</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">model.non.spatial</span>,</span>
<span>  xy <span class="op">=</span> <span class="va">plants_xy</span>,           <span class="co">#data coordinates</span></span>
<span>  repetitions <span class="op">=</span> <span class="fl">30</span>,         <span class="co">#number of spatial folds</span></span>
<span>  training.fraction <span class="op">=</span> <span class="fl">0.75</span>, <span class="co">#training data fraction on each fold</span></span>
<span>  metrics <span class="op">=</span> <span class="st">"r.squared"</span>,</span>
<span>  cluster <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The function creates <code>model.non.spatial$evaluation</code> with
several objects that summarize the spatial cross-validation results.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">model.non.spatial</span><span class="op">$</span><span class="va">evaluation</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "metrics"           "training.fraction" "spatial.folds"    </span></span>
<span><span class="co">#&gt; [4] "per.fold"          "per.fold.long"     "per.model"        </span></span>
<span><span class="co">#&gt; [7] "aggregated"</span></span></code></pre></div>
<p>The slot “spatial.folds”, produced by <a href="https://blasbenito.github.io/spatialRF/reference/make_spatial_folds.html"><code>make_spatial_folds()</code></a>,
contains the indices of the training and testing cases for each
cross-validation repetition. The maps below show two sets of training
and testing folds.</p>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-29-1.png" width="100%"></p>
<p>The information available in this new slot can be accessed with the
functions <a href="https://blasbenito.github.io/spatialRF/reference/print_evaluation.html"><code>print_evaluation()</code></a>,
<a href="https://blasbenito.github.io/spatialRF/reference/plot_evaluation.html"><code>plot_evaluation()</code></a>,
and <a href="https://blasbenito.github.io/spatialRF/reference/get_evaluation.html"><code>get_evaluation()</code></a>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_evaluation.html">plot_evaluation</a></span><span class="op">(</span><span class="va">model.non.spatial</span><span class="op">)</span></span></code></pre></div>
<p><img src="non_spatial_models_files/figure-html/unnamed-chunk-30-1.png" width="100%"><img src="non_spatial_models_files/figure-html/unnamed-chunk-30-2.png" width="100%"></p>
<ul>
<li>
<code>Full</code> is the performance of the model trained on the
full dataset.</li>
<li>
<code>Training</code> is the performance of the model trained on the
training folds.</li>
<li>
<code>Testing</code> is the performance of the model on the testing
folds.</li>
</ul>
<p>The median, median absolute deviation (MAD), minimum, and maximum
R-squared values on the testing folds can be printed with
<code><a href="../reference/print_evaluation.html">print_evaluation()</a></code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spatialRF</span><span class="fu">::</span><span class="fu"><a href="../reference/print_evaluation.html">print_evaluation</a></span><span class="op">(</span><span class="va">model.non.spatial</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Spatial evaluation </span></span>
<span><span class="co">#&gt;   - Training fraction:             0.75</span></span>
<span><span class="co">#&gt;   - Spatial folds:                 29</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Metric Median  MAD Minimum Maximum</span></span>
<span><span class="co">#&gt;  r.squared  0.508 0.09   0.168   0.772</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-prediction">Model prediction<a class="anchor" aria-label="anchor" href="#model-prediction"></a>
</h3>
<p>Models trained with <code><a href="../reference/rf.html">rf()</a></code> can be predicted as
follows.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">model.non.spatial</span>,</span>
<span>  data <span class="op">=</span> <span class="va">plants_df</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"response"</span></span>
<span>  <span class="op">)</span><span class="op">$</span><span class="va">predictions</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>This tutorial covered non-spatial random forest modeling. To learn
how to address spatial autocorrelation in model residuals using spatial
predictors, see the <a href="spatial_models.html">Spatial Random Forest
Models</a> tutorial.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://blasbenito.com" class="external-link">Blas M. Benito</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
